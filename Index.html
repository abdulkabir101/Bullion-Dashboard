<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Bullion Desk</title>
    <style>
        :root {
            --bg: #0a0a0a;
            --card: #141414;
            --gold: #d4af37;
            --gold-soft: #8a6d3b;
            --silver: #e0e0e0;
            --green: #00ff88;
            --red: #ff4d4d;
            --text: #a0a0a0;
        }

        body {
            background-color: var(--bg);
            color: white;
            font-family: 'Segoe UI', Helvetica, sans-serif;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            width: 90%;
            max-width: 1000px;
            padding: 20px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            border-bottom: 1px solid var(--gold-soft);
            padding-bottom: 15px;
            margin-bottom: 30px;
        }

        .header h1 {
            margin: 0;
            font-size: 1.2rem;
            letter-spacing: 3px;
            color: var(--gold);
            text-transform: uppercase;
        }

        #clock {
            font-family: monospace;
            font-size: 1.2rem;
            color: var(--text);
        }

        .controls {
            margin-bottom: 25px;
            display: flex;
            gap: 10px;
        }

        select {
            background: var(--card);
            color: var(--gold);
            border: 1px solid var(--gold-soft);
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
        }

        .card {
            background: var(--card);
            padding: 30px;
            border-radius: 4px;
            border-top: 2px solid var(--gold-soft);
            position: relative;
        }

        .label {
            color: var(--text);
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .price {
            font-size: 3.5rem;
            font-weight: bold;
            font-family: monospace;
            margin: 15px 0;
            transition: color 0.3s;
        }

        .stats {
            display: flex;
            justify-content: space-between;
            border-top: 1px solid #222;
            padding-top: 15px;
            margin-top: 10px;
        }

        .stat-val {
            display: block;
            font-family: monospace;
            font-size: 1rem;
        }

        .high { color: var(--green); }
        .low { color: var(--red); }
        .neutral { color: white; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <div>
            <h1>Bullion Desk</h1>
            <span id="connection-status" style="font-size: 0.7rem; color: var(--text);">● LIVE DATA</span>
        </div>
        <div id="clock">00:00:00</div>
    </div>

    <div class="controls">
        <select id="currency" onchange="updateDisplay()">
            <option value="USD">Currency: USD</option>
            <option value="AED">Currency: AED</option>
        </select>
        <select id="unit" onchange="updateDisplay()">
            <option value="oz">Unit: Ounce (oz)</option>
            <option value="g">Unit: Gram (g)</option>
            <option value="tola">Unit: Tola</option>
        </select>
    </div>

    <div class="grid">
        <div class="card" id="gold-card">
            <span class="label">Gold Spot (XAU)</span>
            <div id="gold-price" class="price neutral">---</div>
            <div class="stats">
                <div><span class="label">High</span><span id="gold-high" class="stat-val">---</span></div>
                <div><span class="label">Low</span><span id="gold-low" class="stat-val">---</span></div>
            </div>
        </div>

        <div class="card" id="silver-card" style="border-top-color: #555;">
            <span class="label">Silver Spot (XAG)</span>
            <div id="silver-price" class="price neutral">---</div>
            <div class="stats">
                <div><span class="label">High</span><span id="silver-high" class="stat-val">---</span></div>
                <div><span class="label">Low</span><span id="silver-low" class="stat-val">---</span></div>
            </div>
        </div>
    </div>
</div>

<script>
    let prices = { gold: 0, silver: 0, goldHigh: 0, goldLow: Infinity, silverHigh: 0, silverLow: Infinity };
    let fxRate = 3.6725;

    // Unit Conversion Constants
    const GRAMS_PER_OZ = 31.1035;
    const TOLA_PER_OZ = 2.6667;

    function updateClock() {
        document.getElementById('clock').innerText = new Date().toLocaleTimeString();
    }

    async function fetchFX() {
        try {
            const res = await fetch('https://api.exchangerate.host/latest?base=USD&symbols=AED');
            const data = await res.json();
            if (data.rates && data.rates.AED) fxRate = data.rates.AED;
        } catch (e) { console.error("FX update failed"); }
    }

    async function fetchMetals() {
    try {
        const [gRes, sRes] = await Promise.all([
            fetch('https://api.metals.live/v1/spot/gold'),
            fetch('https://api.metals.live/v1/spot/silver')
        ]);
        
        const gData = await gRes.json();
        const sData = await sRes.json();

        // Data format: [ ["gold", 2034.25] ]
        prices.gold = gData[0][1];
        prices.silver = sData[0][1];

        // Track session high/low
        if (prices.gold > prices.goldHigh) prices.goldHigh = prices.gold;
        if (prices.gold < prices.goldLow) prices.goldLow = prices.gold;
        if (prices.silver > prices.silverHigh) prices.silverHigh = prices.silver;
        if (prices.silver < prices.silverLow) prices.silverLow = prices.silver;

        document.getElementById('connection-status').innerText = "● LIVE DATA";
        document.getElementById('connection-status').style.color = "var(--green)";
        updateDisplay();
    } catch (e) {
        document.getElementById('connection-status').innerText = "● OFFLINE (CORS BLOCKED)";
        document.getElementById('connection-status').style.color = "red";
    }
}

    function convert(val) {
        const unit = document.getElementById('unit').value;
        const curr = document.getElementById('currency').value;
        let result = val;

        if (unit === 'g') result = val / GRAMS_PER_OZ;
        if (unit === 'tola') result = val / TOLA_PER_OZ;
        if (curr === 'AED') result = result * fxRate;

        return result.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    }

    function updateDisplay() {
        const gEl = document.getElementById('gold-price');
        const sEl = document.getElementById('silver-price');

        gEl.innerText = convert(prices.gold);
        sEl.innerText = convert(prices.silver);
        
        document.getElementById('gold-high').innerText = convert(prices.goldHigh);
        document.getElementById('gold-low').innerText = convert(prices.goldLow);
        document.getElementById('silver-high').innerText = convert(prices.silverHigh);
        document.getElementById('silver-low').innerText = convert(prices.silverLow);

        // Color Logic
        gEl.className = `price ${prices.gold >= prices.goldHigh ? 'high' : prices.gold <= prices.goldLow ? 'low' : 'neutral'}`;
        sEl.className = `price ${prices.silver >= prices.silverHigh ? 'high' : prices.silver <= prices.silverLow ? 'low' : 'neutral'}`;
    }

    setInterval(updateClock, 1000);
    setInterval(fetchMetals, 1000); 
    setInterval(fetchFX, 3600000); // Update FX hourly

    fetchMetals();
    fetchFX();
</script>
</body>
</html>
